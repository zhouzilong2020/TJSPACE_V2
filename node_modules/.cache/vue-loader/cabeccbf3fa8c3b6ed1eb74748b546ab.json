{"remainingRequest":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhouzilong/Desktop/2020-09-19-0005/src/components/userInfo/register.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/src/components/userInfo/register.vue","mtime":1600438418000},{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/vue-cli-plugin-quasar/lib/loader.auto-import.js","mtime":499162500000},{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhouzilong/Desktop/2020-09-19-0005/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBwb3BEaWFsb2cgZnJvbSAiLi4vcG9wRGlhbG9nIjsKaW1wb3J0IHsgc2VudEF1dGhDb2RlIH0gZnJvbSAiLi4vLi4vc2VydmljZXMvdXNlclNlcnZpY2UiOwppbXBvcnQgeyBtYXBTdGF0ZSB9IGZyb20gInZ1ZXgiOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgcG9wRGlhbG9nLAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzUHdkOiB0cnVlLAogICAgICBpc1JQd2Q6IHRydWUsCiAgICAgIHBhc3N3b3JkOiBudWxsLAogICAgICBtb2RlbDogewogICAgICAgIGVtYWlsOiBudWxsLAogICAgICAgIG5pY2tuYW1lOiBudWxsLAogICAgICAgIGF1dGhDb2RlOiBudWxsLAogICAgICAgIHBhc3N3b3JkOiBudWxsLAogICAgICB9LAogICAgICAvLyDorqHml7blmagKICAgICAgdGltZXI6IG51bGwsCiAgICAgIGRvd25DbnQ6IDYwLAoKICAgICAgdmVyaWZpZWQ6IGZhbHNlLAogICAgICBhY2NlcHQ6IGZhbHNlLAogICAgICBhdXRoQ29kZTogbnVsbCwKICAgICAgd2FybmluZ1RleHQ6IG51bGwsCiAgICAgIHdhcm5pbmc6IGZhbHNlLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgc2VudEF1dGhDb2RlVGV4dCgpIHsKICAgICAgaWYgKCF0aGlzLnRpbWVyKSB7CiAgICAgICAgcmV0dXJuICLlj5HpgIHpqozor4HnoIEiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLmRvd25DbnQgKyAic+WQjuWGjeivlSI7CiAgICAgIH0KICAgIH0sCiAgICBpc1NlbmRpbmdBdXRoQ29kZSgpIHsKICAgICAgaWYgKHRoaXMudGltZXIpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgYWNjb3VudEVtYWlsKCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbC5lbWFpbCArICJAdG9uZ2ppLmVkdS5jbiI7CiAgICB9LAogICAgLi4ubWFwU3RhdGUoInVzZXJJbmZvIiwgWyJ0b2tlbiIsICJ1c2VySW5mbyJdKSwKICAgIHNlbnRJc0Rpc2FibGVkKCkgewogICAgICBpZiAodGhpcy5tb2RlbC5lbWFpbCAmJiAhdGhpcy50aW1lcikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICByZWdJc0Rpc2FibGVkKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5tb2RlbC5lbWFpbCAmJgogICAgICAgIHRoaXMubW9kZWwubmlja25hbWUgJiYKICAgICAgICB0aGlzLm1vZGVsLmF1dGhDb2RlICYmCiAgICAgICAgdGhpcy5tb2RlbC5wYXNzd29yZCAmJgogICAgICAgIHRoaXMuYWNjZXB0CiAgICAgICkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgfSwKCiAgbWV0aG9kczogewogICAgYXN5bmMgcG9wV2FybmluZyh0ZXh0KSB7CiAgICAgIHRoaXMud2FybmluZ1RleHQgPSB0ZXh0OwogICAgICB0aGlzLndhcm5pbmcgPSB0cnVlOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLndhcm5pbmcgPSBmYWxzZTsKICAgICAgfSwgMjAwMCk7CiAgICB9LAoKICAgIGFzeW5jIGhhbmRsZUF1dGhDb2RlKCkgewogICAgICBpZiAodGhpcy5pc1NlbmRpbmdBdXRoQ29kZSkgewogICAgICAgIGF3YWl0IHRoaXMucG9wV2FybmluZygi6aqM6K+B5ZCX5bey5Y+R6YCB77yM6K+356iN5ZCO5YaN6K+V77yBIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlc3AgPSBhd2FpdCBzZW50QXV0aENvZGUoewogICAgICAgICAgZW1haWw6IHRoaXMuYWNjb3VudEVtYWlsLAogICAgICAgIH0pOwoKICAgICAgICBjb25zb2xlLmxvZygiaW4gcmVjZWl2aW5nIGF1dGhDb2RlIiwgcmVzcCk7CiAgICAgICAgaWYgKHJlc3AuZGF0YS5zdGF0dXMpIHsKICAgICAgICAgIC8v6K6+572u5YCS6K6h5pe2CiAgICAgICAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5kb3duQ250ID09IDApIHsKICAgICAgICAgICAgICB0aGlzLnRpbWVyID0gY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTsKICAgICAgICAgICAgICB0aGlzLmRvd25DbnQgPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZG93bkNudCAtPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMDAwKTsKCiAgICAgICAgICB0aGlzLmF1dGhDb2RlID0gcmVzcC5kYXRhLmF1dGhDb2RlOwogICAgICAgICAgY29uc29sZS5sb2coInNldCBhdXRoQ29kZSIsIHJlc3AuZGF0YS5hdXRoQ29kZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF3YWl0IHRoaXMucG9wV2FybmluZygi5pyN5Yqh5Zmo6ZSZ6K+v77yM6K+356iN5ZCO5YaN6K+V77yBIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGhhbmRsZVJlZ2lzdGVyKCkgewogICAgICBpZiAodGhpcy5tb2RlbC5hdXRoQ29kZSAhPSB0aGlzLmF1dGhDb2RlKSB7CiAgICAgICAgYXdhaXQgdGhpcy5wb3BXYXJuaW5nKCLpqozor4HnoIHplJnor6/vvIEiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiaW4gc2VudCByZWcgZm9ybSIsIHRoaXMubW9kZWwpOwogICAgICAgIHZhciByZXNwID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInVzZXJJbmZvL3JlZ2lzdGVyVXNlciIsIHsKICAgICAgICAgIGVtYWlsOiB0aGlzLm1vZGVsLmVtYWlsLAogICAgICAgICAgbmlja25hbWU6IHRoaXMubW9kZWwubmlja25hbWUsCiAgICAgICAgICBwYXNzd29yZDogdGhpcy5tb2RlbC5wYXNzd29yZCwKICAgICAgICB9KTsKICAgICAgICBpZiAocmVzcC5zdGF0dXMpIHsKICAgICAgICAgIC8vIOaIkOWKn+iOt+WPlnRva2VuIOihqOekuuaIkOWKn+eZu+W9lQogICAgICAgICAgLy8gY29uc29sZS5sb2coImdldCB1c2VyIHRva2VuIikKICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMudXNlckluZm8pOwogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICBuYW1lOiAiU2VsZkluZm9Nb2RpZnkiLAogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlckluZm8udXNlcmlkLAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOebruWJjeWPquacieaYteensOmHjeWkjeeahOmXrumimAogICAgICAgICAgdGhpcy5wb3BXYXJuaW5nKHJlc3AubXNnKTsKICAgICAgICAgIGlmIChyZXNwLm1zZyA9PSAi5pi156ew6YeN5aSNIikgewogICAgICAgICAgICB0aGlzLm1vZGVsLm5pY2tuYW1lID0gJycKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25pY2tuYW1lJykuZm9jdXMoKQoKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["register.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"register.vue","sourceRoot":"src/components/userInfo","sourcesContent":["<template>\n  <q-card class=\"q-my-md bg-grey-2 my-card col-xs-12\">\n    <q-card-section>\n      <h5 class=\"title\">注册TJSPACE账号</h5>\n      <q-form class=\"q-gutter-md q-px-lg\">\n        <!-- 昵称 -->\n        <q-input\n          id=\"nickname\"\n          v-model=\"model.nickname\"\n          label=\"昵称:\"\n          hint=\"设置你的昵称，最长10位\"\n          lazy-rules\n          :rules=\"[\n            (val) => (val && val.length > 0) || '请输入你的昵称',\n            (val) => val.length <= 10 || '昵称长度不能超过10位',\n          ]\"\n        />\n        <!-- 邮箱 -->\n        <q-input\n          id=\"email\"\n          v-model=\"model.email\"\n          suffix=\"@tongji.edu.cn\"\n          label=\"邮箱：\"\n          hint=\"邮箱将作为您的唯一登录凭证\"\n          lazy-rules\n          :rules=\"[(val) => (val && val.length > 0) || '请输入您的同济邮箱']\"\n        >\n          <template v-slot:after>\n            <q-btn\n              dense\n              flat\n              color=\"primary\"\n              icon=\"send\"\n              :label=\"sentAuthCodeText\"\n              :disable=\"sentIsDisabled\"\n              @click=\"handleAuthCode()\"\n            />\n          </template>\n        </q-input>\n        <!-- 邮箱验证码 -->\n        <q-input\n          v-model=\"model.authCode\"\n          label=\"邮箱验证码：\"\n          lazy-rules\n          :rules=\"[(val) => (val !== null && val !== '') || '请输入验证码']\"\n        />\n        <!-- 输入密码 -->\n        <q-input\n          v-model=\"model.password\"\n          :type=\"isPwd ? 'password' : 'text'\"\n          label=\"密码：\"\n          lazy-rules\n          :rules=\"[\n            (val) => (val !== null && val !== '') || '密码不能为空',\n            (val) => val.length >= 6 || '密码的长度不能少于6位',\n          ]\"\n        >\n          <template v-slot:append>\n            <q-icon\n              :name=\"isPwd ? 'visibility_off' : 'visibility'\"\n              class=\"cursor-pointer\"\n              @click=\"isPwd = !isPwd\"\n            />\n          </template>\n        </q-input>\n        <!-- 再次输入密码 -->\n        <q-input\n          v-model=\"password\"\n          :type=\"isRPwd ? 'password' : 'text'\"\n          label=\"再次输入密码：\"\n          lazy-rules\n          :rules=\"[(val) => val === this.model.password || '两次密码不同']\"\n        >\n          <template v-slot:append>\n            <q-icon\n              :name=\"isRPwd ? 'visibility_off' : 'visibility'\"\n              class=\"cursor-pointer\"\n              @click=\"isRPwd = !isRPwd\"\n            />\n          </template>\n        </q-input>\n      </q-form>\n      <q-toggle\n        class=\"q-px-md\"\n        v-model=\"accept\"\n        label=\"我同意TJSPACE合理的使用我的个人信息\"\n      />\n      <!-- 注册按钮 -->\n      <div class=\"q-py-sm\">\n        <q-btn\n          class=\"queren-btn\"\n          label=\"注册\"\n          :disable=\"regIsDisabled\"\n          color=\"primary\"\n          @click=\"handleRegister()\"\n        />\n      </div>\n    </q-card-section>\n    <pop-dialog\n      :content=\"warningText\"\n      :bgColor=\"'bg-warning'\"\n      :show=\"warning\"\n    />\n  </q-card>\n</template>\n\n<script>\nimport popDialog from \"../popDialog\";\nimport { sentAuthCode } from \"../../services/userService\";\nimport { mapState } from \"vuex\";\nexport default {\n  components: {\n    popDialog,\n  },\n  data() {\n    return {\n      isPwd: true,\n      isRPwd: true,\n      password: null,\n      model: {\n        email: null,\n        nickname: null,\n        authCode: null,\n        password: null,\n      },\n      // 计时器\n      timer: null,\n      downCnt: 60,\n\n      verified: false,\n      accept: false,\n      authCode: null,\n      warningText: null,\n      warning: false,\n    };\n  },\n\n  computed: {\n    sentAuthCodeText() {\n      if (!this.timer) {\n        return \"发送验证码\";\n      } else {\n        return this.downCnt + \"s后再试\";\n      }\n    },\n    isSendingAuthCode() {\n      if (this.timer) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n\n    accountEmail() {\n      return this.model.email + \"@tongji.edu.cn\";\n    },\n    ...mapState(\"userInfo\", [\"token\", \"userInfo\"]),\n    sentIsDisabled() {\n      if (this.model.email && !this.timer) {\n        return false;\n      }\n      return true;\n    },\n    regIsDisabled() {\n      if (\n        this.model.email &&\n        this.model.nickname &&\n        this.model.authCode &&\n        this.model.password &&\n        this.accept\n      ) {\n        return false;\n      }\n      return true;\n    },\n  },\n\n  methods: {\n    async popWarning(text) {\n      this.warningText = text;\n      this.warning = true;\n      setTimeout(() => {\n        this.warning = false;\n      }, 2000);\n    },\n\n    async handleAuthCode() {\n      if (this.isSendingAuthCode) {\n        await this.popWarning(\"验证吗已发送，请稍后再试！\");\n      } else {\n        var resp = await sentAuthCode({\n          email: this.accountEmail,\n        });\n\n        console.log(\"in receiving authCode\", resp);\n        if (resp.data.status) {\n          //设置倒计时\n          this.timer = setInterval(() => {\n            if (this.downCnt == 0) {\n              this.timer = clearInterval(this.timer);\n              this.downCnt = 5;\n            } else {\n              this.downCnt -= 1;\n            }\n          }, 1000);\n\n          this.authCode = resp.data.authCode;\n          console.log(\"set authCode\", resp.data.authCode);\n        } else {\n          await this.popWarning(\"服务器错误，请稍后再试！\");\n        }\n      }\n    },\n\n    async handleRegister() {\n      if (this.model.authCode != this.authCode) {\n        await this.popWarning(\"验证码错误！\");\n      } else {\n        console.log(\"in sent reg form\", this.model);\n        var resp = await this.$store.dispatch(\"userInfo/registerUser\", {\n          email: this.model.email,\n          nickname: this.model.nickname,\n          password: this.model.password,\n        });\n        if (resp.status) {\n          // 成功获取token 表示成功登录\n          // console.log(\"get user token\")\n          console.log(this.userInfo);\n          this.$router.push({\n            name: \"SelfInfoModify\",\n            params: {\n              userId: this.userInfo.userid,\n            },\n          });\n        } else {\n          // 目前只有昵称重复的问题\n          this.popWarning(resp.msg);\n          if (resp.msg == \"昵称重复\") {\n            this.model.nickname = ''\n            document.getElementById('nickname').focus()\n\n          }\n        }\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.title {\n  text-align: center;\n}\n\n.queren-btn {\n  width: 100%;\n}\n\n.my-card {\n  max-width: 420px;\n  opacity: 0.9;\n}\n</style>"]}]}